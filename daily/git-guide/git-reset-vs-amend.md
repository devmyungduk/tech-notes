
## 1. 방법 1: 특정 파일 삭제 및 최근 커밋 수정 (Amend)

이 방법은 저장소의 **기존 커밋 이력을 보존하면서, 최근 커밋에 특정 파일 삭제 내용을 반영**하고자 할 때 사용합니다. 주로 마지막 커밋에 대한 사소한 수정이나 누락된 파일 조작을 포함시킬 때 유용합니다.

*   **관련 상세 가이드:** [remove-file-amend.md](remove-file-amend.md)

### 요약:

*   **목표:** 특정 파일을 삭제하고, 그 삭제 내용을 **가장 최근 커밋에 반영**하여 GitHub 원격 저장소에 동기화합니다.
*   **사용 상황:**
    *   최근 커밋에 실수로 포함된 파일을 제거하고 싶을 때.
    *   삭제된 파일이 왜 GitHub에서 안 사라지지? 를 해결하는 실무용 부분 수정 절차.
    *   마지막 커밋 이후 발견된 작은 변경사항(파일 삭제 등)을 기존 커밋에 합치고 싶을 때.
    *   커밋 이력을 완전히 지우는 것보다, 기존 이력을 유지하며 부분적으로 수정하고 싶을 때.
*   **핵심 접근 방식:**
    1.  `git reset HEAD~1`을 사용하여 마지막 커밋의 변경 사항을 Unstaged 상태로 되돌립니다.
    2.  `git rm -rf --cached .`를 사용하여 Git 인덱스에서 파일 추적을 해제하고, 현재 작업 디렉토리의 상태를 Git이 다시 인식하도록 만듭니다.
    3.  `git add .` 및 `git commit -m "..." --allow-empty`로 삭제 내용을 포함한 새로운 커밋을 생성합니다. (`--allow-empty`는 삭제만 있어도 커밋 가능하게 함)
    4.  `git pull --rebase`로 원격과 동기화 후, `git push --force-with-lease`로 변경된 이력을 원격에 강제로 푸시합니다.
*   **결과:** 기존의 커밋 이력은 대부분 유지되지만, 마지막 커밋은 특정 파일이 삭제된 상태로 수정됩니다.

### 예시 (CMD for Windows):

```cmd
:: Step 1: 마지막 커밋 되돌리기 (변경사항은 작업 디렉토리에 유지)
git reset HEAD~1

:: Step 2: Git 인덱스에서 모든 파일의 추적 해제 (수동 삭제한 파일 포함)
git rm -rf --cached .

:: Step 3: 현재 작업 디렉토리의 모든 파일 상태를 다시 스테이지
git add .

:: Step 4: 삭제 내용을 반영한 새로운 커밋 생성
git commit -m "Remove unwanted files" --allow-empty

:: Step 5: 원격 저장소와 동기화 및 강제 푸시
git pull --rebase origin main
git push --force-with-lease origin main
```

## 2. 방법 2: 저장소 이력 완전 초기화 (Reset)

이 방법은 프로젝트의 **모든 커밋 이력을 완전히 지우고**, 현재 파일 상태를 "초기 커밋"으로 하여 완전히 새로운 이력으로 시작하고자 할 때 사용합니다. 지저분한 이력을 없애고 완전히 새로운 출발을 할 때 적합합니다.

*   **관련 상세 가이드:** [git-repo-history-reset.md](git-repo-history-reset.md)

### 요약:

*   **목표:** 프로젝트의 모든 커밋 이력을 완전히 삭제하고, 현재 파일 상태만을 담은 단일 "Initial Commit"으로 새로 시작합니다.
*   **사용 상황:**
    *   저장소의 커밋 이력이 너무 복잡하거나, 실수로 민감한 정보가 포함되어 완전히 지우고 싶을 때.
    *   테스트용으로 생성된 불필요한 이력을 전부 삭제하고 깨끗한 상태로 본 프로젝트를 시작하고 싶을 때.
    *   협업이 거의 없거나 시작 단계에서 이력을 완전히 재설정해야 할 때.
*   **핵심 접근 방식:**
    1.  로컬 저장소의 `.git` 폴더를 수동으로 삭제하여 모든 Git 이력을 물리적으로 제거합니다.
    2.  동일한 폴더에서 `git init -b main`으로 새로운 Git 저장소를 초기화합니다.
    3.  `git add .` 및 `git commit -m "Initial commit of final project version"`으로 현재 파일 상태를 단일 초기 커밋으로 만듭니다.
    4.  `git remote add origin <YOUR_REPOSITORY_URL>`로 원격 저장소에 다시 연결합니다.
    5.  `git push --force origin main`으로 새로운, 깨끗한 이력을 원격 저장소에 강제로 덮어씁니다.
*   **결과:** 원격 저장소와 로컬 저장소의 모든 과거 커밋 이력이 사라지고, 현재 파일 상태를 담은 단 하나의 초기 커밋만 남게 됩니다.

### 예시:

```bash
# Step 1: 로컬 Git 히스토리 삭제 (.git 폴더 수동 삭제)
# Hidden files을 보이게 설정 후, 프로젝트 루트에서 .git 폴더를 삭제

# Step 2: 새로운 저장소 초기화 및 단일 커밋 생성
git init -b main                       # 새로운 Git 저장소 초기화
git add .                              # 모든 파일 스테이지
git commit -m "Initial commit of final project version" # 초기 커밋 생성

# Step 3: 원격 저장소에 재연결 및 강제 푸시
git remote add origin <YOUR_REPOSITORY_URL> # GitHub 저장소 URL로 대체
git push --force origin main           # 새로운 이력을 원격에 강제 푸시 (매우 위험!)
```

## 3. 핵심 차이점 비교표

| 특징          | **방법 1: 파일 삭제 및 커밋 수정 (Amend)**             | **방법 2: 저장소 이력 완전 초기화 (Reset)**               |
| :------------ | :------------------------------------------------------- | :--------------------------------------------------------- |
| **목표**      | 특정 파일 삭제를 마지막 커밋에 반영, 기존 이력 보존      | 모든 커밋 이력 삭제, 새롭고 깨끗한 이력으로 시작            |
| **수정 범위** | 주로 마지막 커밋 (그리고 해당 파일의 이력)               | 전체 저장소의 모든 이력                                    |
| **주요 명령어** | `git reset`, `git rm --cached`, `git commit --allow-empty`, `git push --force-with-lease` | `.git` 폴더 삭제, `git init`, `git add`, `git commit`, `git push --force` |
| **이력 보존** | 기존 커밋 이력 대부분 유지                               | 모든 기존 커밋 이력 파괴                                   |
| **용도**      | 특정 파일 삭제, 최근 실수 수정, 작은 변경사항 합치기     | 저장소를 완전히 초기화하고 싶을 때, 지저분한 이력 제거       |
| **위험성**    | `force-with-lease`로 비교적 안전하지만, 협업 시 주의     | `git push --force`로 **매우 위험**, 모든 이력이 영구히 삭제됨 |
| **협업 권장** | 협업 중에도 비교적 안전하게 사용 가능 (동료에게 알림 권장) | 협업 중에는 **절대 사용 금지** (동료의 이력이 망가질 수 있음) |

## 결론 및 권장 사항

*   **`git reset HEAD~1` 및 `git commit --amend` 방식**은 기존 이력을 유지하면서 **최근 변경 사항을 깔끔하게 정리**하고자 할 때 유용합니다. 비교적 덜 파괴적이며, 협업 중에도 주의를 기울이면 사용 가능합니다.
*   **`.git` 폴더 삭제 후 `git init` 및 `git push --force` 방식**은 저장소의 **모든 이력을 완전히 지우고 새롭게 시작**할 때 사용합니다. 매우 강력하고 파괴적인 명령이므로, **협업 중인 프로젝트에서는 절대 사용해서는 안 되며**, 개인 프로젝트에서도 신중하게 접근해야 합니다.

*   
<sub>작성자: Neuemuziek
날짜: 2025-10-21
목적: 파일 삭제 및 커밋 수정 스터디 기록용</sub>
